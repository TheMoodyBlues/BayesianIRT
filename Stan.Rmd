---
title: "STAN"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
data.l = data.f %>% 
  as.data.frame() %>% 
  rownames_to_column(var = "id") %>% 
  pivot_longer(2:13, names_to = "item", values_to = "resp")
```

```{r}
formula_va_2pl <- bf(resp ~ exp(logalpha) * eta, eta ~ 1 + (1 | i | item) +
  (1 | id), logalpha ~ 1 + (1 | i | item), nl = TRUE)

# specify some weakly informative priors
prior_va_2pl <- prior("normal(0, 5)", class = "b", nlpar = "eta") +
  prior("normal(0, 1)", class = "b", nlpar = "logalpha") +
  prior("constant(1)", class = "sd", group = "id", nlpar = "eta") +
  prior("normal(0, 3)", class = "sd", group = "item", nlpar = "eta") +
  prior("normal(0, 1)", class = "sd", group = "item", nlpar = "logalpha")

# fit the 2PL model this models throws some convergence warnings which are
# false positives and can be safely ignored
fit_va_2pl <- brm(formula = formula_va_2pl, data = data.l,
  family = brmsfamily("bernoulli", "logit"), prior = prior_va_2pl, seed = 1234,
  file = "models/fit_va_2pl")

# obtain some basic summaries
summary(fit_va_2pl)
# No figure in paper
plot(fit_va_2pl, ask = FALSE)

# extract item parameters
(item_pars_va_1pl <- coef(fit_va_2pl)$item)

```

